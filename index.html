<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MSU Result Calculator</title>
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#eef2f5;margin:0;padding:0}
  header{background:#004080;color:#fff;padding:15px;text-align:center;box-shadow:0 3px 6px rgba(0,0,0,0.2)}
  header h1{margin:0;font-size:18px}
  header p{font-size:10px;margin-top:5px}
  main{max-width:900px;margin:15px auto;padding:15px;background:#fff;border-radius:10px;
       box-shadow:0 5px 12px rgba(0,0,0,0.15)}
  .row{margin:10px 0;display:flex;flex-wrap:wrap;gap:10px}
  label{font-size:12px}
  select,input{padding:6px;font-size:12px;border:1px solid #bbb;border-radius:6px}
  input[type=number]{width:45px;text-align:center}
  button{padding:6px 10px;background:#0056a3;color:#fff;border:none;border-radius:6px;
         box-shadow:0 3px 6px rgba(0,0,0,0.2);cursor:pointer;font-size:12px}
  button:hover{background:#003d73}
  h3{margin-top:20px;color:#333;border-bottom:1px solid #ddd;padding-bottom:5px}
  .inputRow{margin:6px 0;padding:6px;background:#f9fbff;border-radius:8px;
            box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .inputRow label{font-weight:bold;font-size:12px}
  .removeBtn{background:#d9534f !important}
  table{width:100%;border-collapse:collapse;margin-top:12px;font-size:12px}
  th,td{border:1px solid #ccc;padding:6px;text-align:center}
  th{background:#004080;color:#fff}
  .pass{color:green;font-weight:bold}
  .fail{color:red;font-weight:bold}
  .grace{color:#c77700;font-weight:bold}
</style>
</head>
<body>
<header>
  <h1>MSU Result Calculator (Mobile Friendly)</h1>
  <p>यह Maa Shakumbhari University की कोई अधिकारिक साईट/ऐप नहीं है। केवल NEP Result और Grace Marks गणना के लिए बनाया गया है। Result गणना में त्रुटि संभव है।</p>
</header>

<main>
  <!-- Program/Course/Sem Selection -->
  <div class="row">
    <label>Program:
      <select id="programSelect" onchange="setProgram()">
        <option value="">-- Select --</option>
        <option value="UG">UG</option>
        <option value="PG">PG</option>
      </select>
    </label>
    <label>Course:
      <select id="courseSelect"><option value="">-- Select --</option></select>
    </label>
    <label>Semester:
      <select id="semSelect"><option value="">-- Select --</option></select>
    </label>
  </div>

  <!-- Subject Add Buttons -->
  <div id="subjectButtons"></div>

  <!-- Subject Containers -->
  <div id="subjectContainer"></div>

  <div class="row">
    <button type="button" onclick="calculateResult()">Calculate</button>
    <button type="button" onclick="resetAll()">Reset</button>
    <button type="button" onclick="downloadPDF()">Download PDF</button>
  </div>

  <!-- Result Table -->
  <table id="resultTable">
    <thead>
      <tr>
        <th>Subject</th><th>EXT</th><th>Grace</th><th>EXT+</th><th>INT</th><th>Total</th><th>Status</th><th>Remark</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <h3 id="overall"></h3>
</main>

<!-- jsPDF & AutoTable -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<script>
let PROGRAM=""; let subjId=0;

function setProgram(){
  PROGRAM=document.getElementById("programSelect").value;
  const courseSel=document.getElementById("courseSelect");
  const semSel=document.getElementById("semSelect");
  const btnBox=document.getElementById("subjectButtons");
  const container=document.getElementById("subjectContainer");

  courseSel.innerHTML='<option value="">-- Select --</option>';
  semSel.innerHTML='<option value="">-- Select --</option>';
  btnBox.innerHTML=""; container.innerHTML="";

  if(PROGRAM==="UG"){
    ["B.A.","B.Sc.","B.Com."].forEach(c=>{
      let op=document.createElement("option"); op.text=c; courseSel.add(op);
    });
    for(let i=1;i<=6;i++){ let op=document.createElement("option"); op.text=i; semSel.add(op); }

    btnBox.innerHTML=`
      <button onclick="addSubject('Major Theory')">+ Major Theory</button>
      <button onclick="addSubject('Major Practical')">+ Major Practical</button>
      <button onclick="addSubject('Minor')">+ Minor</button>
      <button onclick="addSubject('Skill Development')">+ Skill Development</button>
      <button onclick="addSubject('Co-Curricular')">+ Co-Curricular</button>
      <button onclick="addSubject('Project')">+ Project</button>`;
  }
  else if(PROGRAM==="PG"){
    ["M.A.","M.Sc.","M.Com."].forEach(c=>{
      let op=document.createElement("option"); op.text=c; courseSel.add(op);
    });
    for(let i=1;i<=4;i++){ let op=document.createElement("option"); op.text=i; semSel.add(op); }

    btnBox.innerHTML=`
      <button onclick="addSubject('Major Theory')">+ Major Theory</button>
      <button onclick="addSubject('Major Practical')">+ Major Practical</button>
      <button onclick="addSubject('Minor')">+ Minor</button>
      <button onclick="addSubject('Project')">+ Project</button>`;
  }
}

function addSubject(type){
  subjId++;
  const box=document.getElementById("subjectContainer");
  let html="";
  if(type==="Project"){
    html=`<div class="inputRow" id="row${subjId}">
      <label>${type}:</label>
      Marks <input type="number" maxlength="3" data-subject="${type}" data-kind="ext">
      <button class="removeBtn" onclick="removeSubject(${subjId})">x</button>
    </div>`;
  } else {
    html=`<div class="inputRow" id="row${subjId}">
      <label>${type}:</label>
      EXT <input type="number" maxlength="2" data-subject="${type}" data-kind="ext">
      INT <input type="number" maxlength="2" data-subject="${type}" data-kind="int">
      <button class="removeBtn" onclick="removeSubject(${subjId})">x</button>
    </div>`;
  }
  box.insertAdjacentHTML("beforeend",html);
}
function removeSubject(id){document.getElementById("row"+id).remove();}

function calculateResult(){
  const tbody=document.querySelector("#resultTable tbody");
  tbody.innerHTML="";
  let rows=document.querySelectorAll("#subjectContainer .inputRow");
  let overall="PASS";
  let graceLeft=5, graceUsed=0, graceSubjects=0;

  rows.forEach(r=>{
    let inputs=r.querySelectorAll("input");
    let type=inputs[0].dataset.subject;
    let ext=Number(inputs[0].value||0);
    let int=inputs[1]?Number(inputs[1].value||0):0;
    let total=ext+int;
    let passUE=0, passTotal=0;

    if(PROGRAM==="UG"){
      if(type==="Skill Development") passTotal=40, passUE=0;
      else if(type==="Co-Curricular") passTotal=33, passUE=0;
      else if(type==="Project") passTotal=40, passUE=0;
      else { passTotal=33; passUE=10; }
    }
    else if(PROGRAM==="PG"){
      if(type==="Project") passTotal=40, passUE=0;
      else { passTotal=40; passUE=13; }
    }

    let status="PASS", remark="-", grace=0;
    if(total<passTotal || (passUE>0 && ext<passUE)){
      // Need Grace?
      let needUE=passUE>0?Math.max(0,passUE-ext):0;
      let needTot=Math.max(0,passTotal-total);
      let need=Math.max(needUE, needTot);

      if(need>0){
        let canApply=false;
        if(PROGRAM==="UG" && type!=="Project"){
          if(graceSubjects<2 && graceUsed+need<=5){
            canApply=true;
          }
        }
        else if(PROGRAM==="PG" && type!=="Skill Development" && type!=="Co-Curricular" && type!=="Project"){
          if(need<=3 && graceSubjects<2 && graceUsed+need<=5){
            canApply=true;
          }
        }
        if(canApply){
          grace=need;
          ext+=grace;
          total=ext+int;
          status="PASS"; remark="Grace Applied";
          graceUsed+=grace; graceSubjects++;
        } else {
          status="FAIL"; remark="Need "+need+" marks";
          overall="FAIL";
        }
      } else {
        status="FAIL"; remark="Below Passing";
        overall="FAIL";
      }
    }

    tbody.innerHTML+=`<tr>
      <td>${type}</td><td>${inputs[0].value||0}</td><td class="grace">${grace}</td>
      <td>${ext}</td><td>${int}</td><td>${total}</td>
      <td class="${status==='PASS'?'pass':'fail'}">${status}</td><td>${remark}</td>
    </tr>`;
  });
  document.getElementById("overall").innerText="Overall: "+overall;
}

function resetAll(){
  document.getElementById("programSelect").value="";
  document.getElementById("courseSelect").innerHTML="<option>-- Select --</option>";
  document.getElementById("semSelect").innerHTML="<option>-- Select --</option>";
  document.getElementById("subjectButtons").innerHTML="";
  document.getElementById("subjectContainer").innerHTML="";
  document.querySelector("#resultTable tbody").innerHTML="";
  document.getElementById("overall").innerText="";
}

function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc=new jsPDF({orientation:"portrait",unit:"pt",format:"a4"});
  doc.setFontSize(14);
  doc.text("MSU Grade Card",220,30);
  doc.autoTable({html:"#resultTable",startY:50,theme:"grid",styles:{fontSize:9}});
  doc.save("GradeCard.pdf");
}
</script>
</body>
  </html>
